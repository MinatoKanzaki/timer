<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>timer</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="design.css">
  </head>
  <body>
    <audio id="ringSound">
      <source src="http://soundbible.com/mp3/service-bell_daniel_simion.mp3" type="audio/mp3">
    </audio>
    <div class="timer-main-box">
        <div class="time-box" id="01">
          <input type="text" name="" value="01" id="min" oninput="value=value.replace(/^([7-9][0-9]|6[1-9])|([0-9][0-9]{2,})|([^0-9])$/,'')" >
          <p>:</p>
          <input type="text" name="" value="35" id="second" oninput="value=value.replace(/^([7-9][0-9]|6[1-9])|([0-9][0-9]{2,})|([^0-9])$/,'')" >
        </div>
        <div class="running-time-box" id="02">
          <p id="real">00:00</p>
        </div>
        <div class="timer-controler" id="03">
          <button class="start-button" type="button" name="button" id="start">start</button>
        </div>
        <div class="option-box" id="04">
          <span>How much second do to you want to random:</span>
          <input type="number" name="" value="15" id="random">
        </div>
        <button class="end-button" type="button" name="button" id="end">restart</button>
        <button class="ok-button" type="button" name="button" id="ok">OK</button>
    </div>



    <script type="text/javascript" async>
      let timePassed = 0;
      let timeLeft = 0;
      let totalTime = 0;
      let originalTotalTime = 0;
      let randomSecond = 0;
      let formattedTime = 0;
      let sound = document.getElementById("ringSound");
      let showRandomTime = 0;

      // use to format the time
      const timeForatter = time => {
        if(Math.floor(time/60) < 10) {
          if (time%60 < 10) {
            return `0${Math.floor(time/60)}:0${time%60}`
          } else {
            return `0${Math.floor(time/60)}:${time%60}`
          }
        } else {
          if (time%60 < 10) {
            return `${Math.floor(time/60)}:0${time%60}`
          } else {
            return `${Math.floor(time/60)}:${time%60}`
          }
        }
      }

      // play the ring sound
      const playSound = () => {
        sound.play();
      }

      // time main programme
      const startTimer = () => {
        timerInterval = setInterval(() => {
          timePassed++ ;
          timeLeft = totalTime - timePassed;
          if (timeLeft === 0) {
            let randomTime = Math.floor(Math.random() * randomSecond);
            document.getElementById("03").innerHTML = `<p>this time the random number is <span class="colored">${randomTime}</span></p>`;
            timeLeft = originalTotalTime + randomTime;
            totalTime = timeLeft;
            timePassed = 0;
            showRandomTime = randomTime;
            playSound();
          }
          formattedTime = timeForatter(timeLeft);
          document.getElementById('real').innerHTML = `${formattedTime}`
          document.title = `${formattedTime} R:${showRandomTime}` //change title
        }, 1000)
      }

      // when click start to start initialization
      let start = document.getElementById('start');
      let end = document.getElementById("end");
      let ok = document.getElementById("ok");


      start.addEventListener("click", () => {
        let min = parseInt(document.getElementById('min').value);
        let second = parseInt(document.getElementById('second').value);
        randomSecond = document.getElementById('random').value;
        originalTotalTime = min*60 + second;
        totalTime = originalTotalTime;
        if (originalTotalTime <= 0 || min === '') {
          document.getElementById("01").style.display = "none";
          document.getElementById("04").style.display = "none";
          document.getElementById("03").innerHTML = `<p class="warning">Time cannot be less than 0 second</p>`;
          ok.style.display = "block";
        } else {
          document.getElementById('real').innerHTML = timeForatter(totalTime);
          end.style.display = "block";
          document.getElementById("01").style.display = "none";
          document.getElementById("02").style.display = "block";
          randomTime = randomSecond;
          document.getElementById("03").innerHTML = `<p>this time the random number is <span class="colored">${randomTime}</span></p>`;
          document.getElementById("04").style.display = "none";
        }
      });

      start.addEventListener("click", startTimer);

      end.addEventListener("click", () => {
        location.reload();
      });

      ok.addEventListener("click", () => {
        location.reload();
      });
    </script>

  </body>
</html>
